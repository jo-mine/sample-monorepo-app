# Excel設計書 → Markdown 変換エージェントスキル

## 概要

このスキルは、Excel設計書（`.xlsx` / `.xls`）をMarkdown形式に変換します。
コンテキストとして渡されたExcelファイルを受け取り、LibreOfficeを使用してPDFに変換し、
さらにPDFを各ページのPNG画像に変換します。その後、**エージェントが画像を視覚的に解析**して、
方眼紙レイアウトを忠実に再現したMarkdownファイルを生成します。

## 入力

- **Excelファイル**: `.xlsx` または `.xls` 形式の設計書ファイル（コンテキストとして受け取る）

## 前提条件

- **LibreOffice** がインストールされていること（`libreoffice` コマンドが実行可能であること）
- **poppler-utils** がインストールされていること（`pdftoppm` コマンドが実行可能であること）
- Linuxまたはそれに準じる環境で実行されること

## 処理手順

1. コンテキストからExcelファイルのパスを取得する
2. 以下のスクリプトを実行して、PDF変換とページ画像の生成を行う
   ```bash
   .github/scripts/excel-to-markdown.sh <Excelファイルパス>
   ```
3. スクリプトの標準出力から `MARKDOWN_OUTPUT` と `PAGE_IMAGE` の値を読み取る
4. 各 `PAGE_IMAGE` の画像ファイルを**視覚的に解析**する
5. 解析結果をもとに、方眼紙レイアウトを忠実に再現したMarkdownを `MARKDOWN_OUTPUT` パスに書き出す

## 出力パス規約

| ファイル種別 | 出力パス |
|---|---|
| 一時出力PDF | `{プロジェクトルート}/.github/work/{Excelファイル名（拡張子なし）}.pdf` |
| 一時出力PNG画像 | `{プロジェクトルート}/.github/work/{Excelファイル名（拡張子なし）}-{ページ番号}.png` |
| 最終出力Markdown | `{プロジェクトルート}/.github/work/{Excelファイル名（拡張子なし）}.md` |

## 視覚的解析によるMarkdown変換ガイドライン

各ページ画像を視覚的に解析してMarkdownを生成する際は、以下のルールを適用する：

- **レイアウトの忠実な再現**: 方眼紙（グリッド）状のレイアウトを維持し、セルの位置関係を保持する
- **ラベルと入力値のペア**: ラベル（項目名）と入力値の水平・垂直の位置関係を正確に抽出し、Markdownテーブルで表現する
- **表形式データ**: セル境界線で区切られた領域はMarkdownテーブル（`|`）として再現する
- **見出し**: 結合セルや太字で強調された短いテキストは `##` 見出しとして扱う
- **箇条書き**: 項目列挙は `-` を用いた箇条書きに変換する
- **画像・図**: 図や画像は `<!-- 図: [説明] -->` のコメントとして記録する
- **改ページ**: ページの区切りはMarkdownの水平線（`---`）として表現する
- **空セル**: 入力値が空のセルも「（空欄）」等として明示し、レイアウトを維持する

## エラーハンドリング

- Excelファイルが存在しない場合はエラーメッセージを出力して終了する
- LibreOfficeがインストールされていない場合はインストール手順を案内して終了する
- PDF変換に失敗した場合は詳細なエラー内容を出力して終了する
